(function(window){
  function SimpleKetcher(opts){
    this.element = (opts && opts.element) || document.createElement('div');
    // create a textarea to act as a simple molecule editor (SMILES input)
    var ta = document.createElement('textarea');
    ta.style.width = '100%';
    ta.style.height = '100%';
    ta.style.background = 'transparent';
    ta.style.color = 'inherit';
    ta.placeholder = 'Enter SMILES here (simple fallback editor)';
    this.element.appendChild(ta);
    this._ta = ta;
    var self = this;
    this.editor = {
      subscribe: function(ev, cb){ if(ev === 'change' && typeof cb === 'function'){ ta.addEventListener('input', cb); } }
    };
  }
  SimpleKetcher.prototype.getSmiles = function(){ return Promise.resolve(this._ta.value || ''); };
  SimpleKetcher.prototype.setMolecule = function(s){ try{ this._ta.value = s || ''; }catch(e){} };
  SimpleKetcher.prototype.addFragment = function(s){ try{ this._ta.value = s || ''; }catch(e){} };
  window.Ketcher = SimpleKetcher;
  window.createKetcher = function(opts){ return new SimpleKetcher(opts); };
})(window);
